<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Smoke Browser Runner</title>
    <style type="text/css">
        * {
            font-family: sans-serif;
        }

        #bd-smoke, #bd-smoke-results {
            margin: 1em;
        }

        .error {
            font-size: 150%;
            font-weight: bold;
            color: red;
        }
    </style>
</head>
<body>
<div id="bd-smoke">
    <h2>Smoke Test Page</h2>
    <p>This is a specialized runner that loads different versions of smoke depending on the URL param "smoke".</p>

    <p id="options">
    </p>

    <div id="bd-smoke-results">
        <!--default place for smoke to write results-->
    </div>
</div>


<!--tests can hang stuff off of root-->
<div id="bd-smoke-root"></div>

<script>
	(function(){
		var qString = decodeURIComponent(window.location.search);
		var match = qString.match(/smoke=\s*([^&\s]+)/);
		if(match){
			var node = document.createElement('script');
			node.src = match[1];
			node.type = /es6|src/.test(match[1]) ? 'module' : '';
			document.getElementsByTagName('script')[0].parentNode.appendChild(node);
		}else if(qString){
			document.getElementById("options").innerHTML = '<p class="error">no smoke option given; don\'t know what to do</p>';
			return;
		}else{
			var tests = [
                // notice for this first entry, we can't use the default startup which automatically loads ../smoke.config.es6.js
				// because ../smoke.config.es6.js includes a test module that assumes smoke is at ../smoke.es6.js
                // and JS6 modules don't allow for conditional imports
				["Source version (es6 module)", "smoke=../src/smoke.js&load=./test/trivial-src.es6.js"],

				// default startup automatically loads ../smoke.config.js
				["Source version (es6 module) with smoke defined at window.smoke", "smoke=../src/smoke-global.js"],

				// default startup automatically loads ../smoke.config.es6.js
				["Rollup es6 version (es6 module)", "smoke=../smoke.es6.js"],

                // default startup automatically loads ../smoke.config.js
				["Rollup UMD version", "smoke=../smoke.js"],
			];
			document.getElementById("options").innerHTML = '<h3>Load Options</h3>' + tests.map(function(test){
				return '<p>' + test[0] + ' <a href="' + window.location.href + "?" + test[1] + '&root=../">' + test[1] + '</a></p>';
			}).join('\n');
		}
	})();
</script>

</body>
</html>
